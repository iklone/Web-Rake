<html>
    <head>
    <title>WebRake</title>
	  <link rel = "stylesheet" type = "text/css" href = "main.css">
    <script language="Javascript">
    function postRequest(strURL) {
	var xmlHttp;
          if (window.XMLHttpRequest) { 
		 var xmlHttp = new XMLHttpRequest();
	    }else if (window.ActiveXObject) { 
		var xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
	      }
	    xmlHttp.open('POST', strURL, true);
	    xmlHttp.setRequestHeader
              ('Content-Type', 'application/x-www-form-urlencoded');
		xmlHttp.onreadystatechange = function() {
	if (xmlHttp.readyState == 4) {
	       updatepage(xmlHttp.responseText);
	      }
	   }
	 xmlHttp.send(strURL);
        }
     function updatepage(str){
	document.getElementById("result").innerHTML = 
            "<font color='red' size='5'>" + str + "</font>";;
        }
   function Task(){
	var usr=window.document.f1.username.value;
	var rnd = Math.random();
	var url="taskSelection.php?id="+rnd +"&usr="+usr;
	postRequest(url);
        }
	function deleteVerify() {
            var result = confirm("Are you sure you want to delete this task?");
            if (result == true) {

            } else {

            }
        }
		function insertTaskListing(name) {
			var article = document.createElement("article");

			var title = document.createElement("span");
			title.innerHTML = name;
			article.appendChild(title);

			var meta = document.createElement("h6");
			meta.innerHTML = "TODO";
			article.appendChild(meta);

			document.getElementById("taskListing").appendChild(article);
		}
  </script>
  </head>
  <body>
  

	<h1 onclick="window.location.href='./main.php'">Web Scrape</h1>

    <span class="leftTopBar">
        <form>
            <input type="text" placeholder="Search tasks...">
            <button type="button">Search</button>
        </form>
    </span>

    <span class="rightTopBar">
         <i>Logged in as psyjct</i>
    </span>

    <div id="taskListing" class="split left" style="overflow: scroll;">
		
		<div id='showTask'></div><br>
<input type="button" onclick="previous()" value="Previous Task">
<input type="button" onclick="next()" value="Next Task">

<script>
var i = 0;
var x;
displayTask(i);

function displayTask(i) {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            myFunction(this, i);
        }
    };
    xmlhttp.open("GET", "taskList.xml", true);
    xmlhttp.send();
}

function myFunction(xml, i) {
    var xmlDoc = xml.responseXML; 
    x = xmlDoc.getElementsByTagName("TASK");
    document.getElementById("showTask").innerHTML =
    "Task Name: " +
    x[i].getElementsByTagName("TASKNAME")[0].childNodes[0].nodeValue +
    "<br>Task Number: " +
    x[i].getElementsByTagName("TASKNUMBER")[0].childNodes[0].nodeValue +
    "<br>Creator: " + 
    x[i].getElementsByTagName("CREATOR")[0].childNodes[0].nodeValue +
	"<br>Country: " +
	x[i].getElementsByTagName("COUNTRY")[0].childNodes[0].nodeValue +
	"<br>Company: " +
	x[i].getElementsByTagName("COMPANY")[0].childNodes[0].nodeValue;
}

function next() {
if (i < x.length-1) {
  i++;
  displayTask(i);
  }
}

function previous() {
if (i > 0) {
  i--;
  displayTask(i);
  }
}
</script>

	
		   <h1 align="center"><font color="#000080">WebRake</font></h1>
   <p  align="center"><font color="#000080">Enter which Task number you would like to go to and then press the "search" button"</font></p>
 <form name="f1">
       <p align="center"><font color="#000080">&nbsp;
		Enter your Task number: <input type="text" name="username" id="username">
		<input value="Search" type="button" 
       onclick='JavaScript:Task()' name="showdate"></font></p>
       <div id="result" align="center"></div>
     </form>
 <div id=result></div>
        <article class="newTask">
            +New Task
        </article>
        <article>
            <span class="taskName">Task A</span><span class="taskMeta">Next: 10:50</span>
        </article>
		
		<script>
		<?php
			include 'db.php';
			$taskData = mysqli_query($conn, 'SELECT * FROM Task;');
			foreach ($taskData as $task){
				echo 'insertTaskListing("' . $task["taskName"] . '");';
			}
		?>
		</script>
		
        <div style="margin: 100px;"></div>
    </div>

    <div class="split right">
        <div style="margin:15px">
            <span class="selectedTaskName">Task A</span>
            <span class="rightButtons">
                <a href="./editTask.php"><button>Edit</button></a>
                <button onclick="deleteVerify()">Delete</button>
            </span>
            <p>Description</p>
            Access by:
            <ul>
                <li>user</li>
                <li>group</li>
            </ul>
            <div class="taskURL"><a href="http://example.com">http://example.com</a></div>
            <ul>
                <li>Page Title</li>
                <li>Value</li>
            </ul>

            <table>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Value</th>
                    <th>Timestamp</th>
                </tr>
                <tr>
                    <td>0</td>
                    <td>Page Title</td>
                    <td>"Hello World"</td>
                    <td>0900</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>Value</td>
                    <td>110</td>
                    <td>0900</td>
                </tr>
            </table>
        </div>
    </div>
</body>
</html>